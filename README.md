# IPTV Filter

This repository provides tools to filter and generate custom IPTV channel lists (M3U and XML) from the [iptv-org](https://github.com/iptv-org/iptv) project and local EPG data. It is designed for users who want to create a personalized, deduplicated, and language-filtered IPTV playlist, as well as a matching XML channel list for EPG purposes.

## Features
- **Filter IPTV channels** from the iptv-org US M3U list using allowlist/denylist rules and language preferences.
- **Deduplicate** channels by `tvg-id` or `tvg-name`.
- **Prefer HTTPS and .m3u8** streams when available.
- **Generate a custom M3U playlist** (`channels.m3u`).
- **Generate a matching XML channel list** (`channels.xml`) for EPG tools, based on your filtered M3U and a local clone of the iptv-org/epg repo.

## Files
- `generate_channels_m3u.py`: Script to download, filter, and generate a custom `channels.m3u` playlist.
- `generate_channels_xml.py`: Script to generate a `channels.xml` file for EPG, matching the channels in your M3U.
- `allowlist.txt`: (Optional) List of rules to include channels. If present, only matching channels are kept.
- `channels.m3u`: Output playlist generated by the script.
- `channels.xml`: Output XML channel list for EPG.

## Usage

### 1. Generate a filtered M3U playlist
```bash
python generate_channels_m3u.py [--source <M3U_URL_or_file>] [--allow allowlist.txt] [--deny denylist.txt] [--out channels.m3u] [--no-english-only] [--dedup tvg-id|tvg-name|none]
```
- By default, downloads the US M3U from iptv-org and applies English-only filtering, deduplication, and allow/deny rules.
- Edit `allowlist.txt` to specify which channels to keep (see script for rule syntax).

### 2. Generate a matching XML channel list for EPG
```bash
python generate_channels_xml.py --m3u channels.m3u --epg-dir <path_to_local_epg_repo> [--out channels.xml]
```
- Requires a local clone of [iptv-org/epg](https://github.com/iptv-org/epg).
- Produces `channels.xml` with only the channels present in your filtered M3U.

## Requirements
- Python 3.7+
- `requests` library (for `generate_channels_m3u.py`)

Install dependencies:
```bash
pip install -r requirements.txt
```

## Example Workflow
1. Edit `allowlist.txt` to define your channel selection rules.
2. Run `generate_channels_m3u.py` to create your custom `channels.m3u`.
3. Run `generate_channels_xml.py` to create a matching `channels.xml` for EPG tools.

## License
MIT
